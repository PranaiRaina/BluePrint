version: '3.8'

services:
  # 1. Frontend (BluePrint UI)
  frontend:
    build: ./frontend
    container_name: blueprint_frontend
    ports:
      - "3000:80"
    depends_on:
      - calc-agent
    networks:
      - blueprint_network

  # 2. Backend API (Manager Agent)
  calc-agent:
    build: .
    container_name: blueprint_backend
    ports:
      - "8001:8001"
    environment:
      # API Keys (External Tools)
      - GROQ_API_KEY=${GROQ_API_KEY}
      - WOLFRAM_APP_ID=${WOLFRAM_APP_ID}
      - TAVILY_API_KEY=${TAVILY_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - FINNHUB_API_KEY=${FINNHUB_API_KEY}

      # Supabase (The New Database & Vector Store)
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
      - SUPABASE_DB_URL=${SUPABASE_DB_URL}

      # Note: SUPABASE_JWT_SECRET is often not needed unless you are decoding tokens manually, 
      # but safe to keep if your code references it.
      - SUPABASE_JWT_SECRET=${SUPABASE_JWT_SECRET}

    command: uvicorn ManagerAgent.api:app --host 0.0.0.0 --port 8001
    networks:
      - blueprint_network

# No volumes needed anymore (Data lives in Supabase Cloud)

networks:
  blueprint_network:
    driver: bridge
